# セキュリティ関係のおぼえがき

## CSRF

本来受け付けるべきではない、必要がない外部からのリクエストを受け付けてしまう脆弱性。

セッションハイジャックやなりすましを行うことができる。

Cross Site Request Forgeries クロスサイトリクエストフォージェリーのフォージェリーとは"偽造"のこと。
クロスサイトは本来リクエストを受けるべきではない別のサイト(攻撃サイト)からのリクエストによって、自サイト(ターゲットサイト)の何らかの機能が実行されることを指している。

クライアントとサイト間の通信が偽造が可能な場合、つまりユニークな判別ができない場合に問題が発生する。

具体的に発生した事件では...

- [はまちちゃんによるmixiへのCSRF投稿](http://www.atmarkit.co.jp/fsecurity/column/ueno/33.html)

などがある。

たとえば認証済みセッションが保存されたクッキーなどが使用されると簡単にCSRFを実行可能となる。
たとえば、ターゲットサイトへのform要素を用意して攻撃ページ読み込み時に実行(onload)すれば、クライアントブラウザは正しいセッションをサイト側に渡すことになる。そのためセッションの保持時間を短くする、出来る限りログアウトするなどの対処が有効。

対処方法としては、通信の一意性を担保することになる。特にはセッションを用いたクライアントの追跡IDが狙われるので、その点を以下に攻撃者に偽造させないかが鍵になる。
たとえばクライアントの一意性の担保のためにページ遷移の追跡や、攻撃者が知り得ないIDなどを別に発行するなどがある。

- 前ページにhidden要素で前のセッションIDを書き込み、次のページで新セッションIDと旧セッションIDの組でページ移動を追跡する。
- ログイン後に新規セッションIDを発行して元セッションを破棄する。
- リファラーで前ページを確認する
- CAPTHAをつかう
- 購入直前で再度ログインさせ新規セッションIDを発行して元セッションIDとで追跡する。
- cookieにsame origin policy(sessionのdomainパラメータによる同一ドメイン確認。実際にはドメインは後方一致、パスは前方一致で確認されるため、.co.jpなどのセカンドドメインのみの設定を受け入れるようなブラウザの場合は効かない)を設定する

## XSS
## セッションフィクセーション

